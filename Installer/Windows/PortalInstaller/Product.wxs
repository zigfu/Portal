<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="90929a50-93be-476e-bd29-ee4b70ba5b77" Name="ZigFu Portal" Language="1033" Version="1.0.2.0" Manufacturer="ZigFu" UpgradeCode="97a671a7-ab73-49fe-a237-37b6a331747d">
		<Package InstallerVersion="200" Compressed="yes" Id="*" Description="ZigFu Portal Installer"/>
    <Property Id="PREVIOUSVERSIONINSTALLED" Secure="yes" />
    <Upgrade Id="97a671a7-ab73-49fe-a237-37b6a331747d">
      <UpgradeVersion 
        Minimum="1.0.0.0" 
        Maximum="1.0.1.0" 
        IncludeMinimum="yes" 
        IncludeMaximum="yes"
        Property="PREVIOUSVERSIONINSTALLED"></UpgradeVersion>
    </Upgrade>
		<Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <Icon Id="icon.exe" SourceFile="icon.ico"/>
    <Property Id="ARPPRODUCTICON" Value="icon.exe" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- define base output dir -->
      <Directory Id="LocalAppDataFolder">
        <Directory Id="BaseOutputDir" Name="ZigFu">
          <Directory Id="PortalBaseDir" Name="Portal">
            <Directory Id="BinariesDir" Name="bin">
              <Component Id="Shortcuts" Guid="1CF5E239-71B4-43E5-B566-0BFF6A0D5C4B">
                <File Id="MainExecutable" KeyPath="yes" Source="$(var.PortalOut)\bin\Portal.exe">
                <!-- these shortcuts are a nasty hack, but they work (ideally I could add them to the auto-generated 
                   output from heat.exe at Files.wxs (ideally they should be under the File element containing the Portal exe) -->
                <!-- this is going to change on the next major version of WIX -->
                <Shortcut Id="startmenuPortal" Directory="ProgramMenuDir" Name="Portal"
                          WorkingDirectory="BinariesDir" Advertise="yes" Icon="icon.exe"/>
                <Shortcut Id="desktopPortal" Directory="DesktopFolder" Name="Portal"
                          WorkingDirectory="BinariesDir" Advertise="yes" Icon="icon.exe"/>
                </File>
              </Component>
              
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />
      
      <!-- directories for shortcuts -->
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuContainerDir" Name="ZigFu">
          <Directory Id="ProgramMenuDir" Name="Portal">
            <Component Id="ProgramMenuDir" Guid="1C3983DB-B982-48CB-845F-8E2F4D1F85F2">
              <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
              <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
            </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    
    <UIRef Id="WixUI_Minimal"/>
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf"/>
    <WixVariable Id="WixUIBannerBmp" Value="neonBG.bmp"/>
    <WixVariable Id="WixUIDialogBmp" Value="neonFirstScreen.bmp"/>

    <InstallExecuteSequence>
      <RemoveExistingProducts After="InstallInitialize" />
    </InstallExecuteSequence>
    
		<Feature Id="ProductFeature" Title="Portal" Level="1">
			<ComponentGroupRef Id="AllFiles" />
      <ComponentRef Id="ProgramMenuDir" />
      <ComponentRef Id="Shortcuts" />
			<!-- Note: The following ComponentGroupRef is required to pull in generated authoring from project references. -->
			<!-- <ComponentGroupRef Id="Product.Generated" /> -->
		</Feature>
	</Product>
</Wix>
